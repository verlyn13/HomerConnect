modules = ["nodejs-20"]
[nix]
channel = "stable-24_05"

[workflows]
runButton = "Init Stage"

[[workflows.workflow]]
name = "Frontend Dev"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/frontend && npm run dev"

[[workflows.workflow]]
name = "Init Stage"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "#!/bin/bash"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "set -e  # Exit on any error"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"üöÄ Starting initialization process...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "# Setup directories"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"üìÅ Creating directory structure...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "mkdir -p apps/frontend/src apps/backend/src || { echo \"‚ùå ERROR: Failed to create directory structure\"; exit 1; }"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "# Frontend setup"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"‚öõÔ∏è Setting up frontend...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! cd apps/frontend; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Failed to enter frontend directory - directory may not exist\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if [ ! -f \"package.json\" ]; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: package.json not found in frontend directory ($(pwd))\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"üí° TIP: Ensure package.json exists in apps/frontend/\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"üì¶ Installing frontend dependencies...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! npm install; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Frontend npm install failed\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"üí° TIP: Check package.json for invalid dependencies\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! cd ../..; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Failed to return to root directory\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "# Backend setup"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"üîß Setting up backend...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! cd apps/backend; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Failed to enter backend directory - directory may not exist\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if [ ! -f \"package.json\" ]; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: package.json not found in backend directory ($(pwd))\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"üí° TIP: Ensure package.json exists in apps/backend/\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"üì¶ Installing backend dependencies...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! npm install; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Backend npm install failed\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"üí° TIP: Check package.json for invalid dependencies\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "if ! cd ../..; then"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    echo \"‚ùå ERROR: Failed to return to root directory\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "    exit 1"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "fi"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = ""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"‚úÖ Init Stage completed successfully!\""

[[workflows.workflow]]
name = "Backend Dev"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/backend && npm run start:dev"

[[workflows.workflow]]
name = "Full Stack Dev"
author = 22265372
mode = "parallel"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/frontend && npm run dev"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/backend && npm run start:dev"

[[workflows.workflow]]
name = "Lint & Format"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/frontend && npm run lint && npm run format"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd ../backend && npm run lint && npm run format"

[[workflows.workflow]]
name = "Test"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/frontend && npm run test"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd ../backend && npm run test"

[[workflows.workflow]]
name = "Build"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/frontend && npm run build"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd ../backend && npm run build"

[[workflows.workflow]]
name = "Setup NestJS"
author = 22265372
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd apps/backend && npx @nestjs/cli new . --package-manager npm --language typescript --directory . --skip-git --skip-install"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd ../.."

[[ports]]
localPort = 3000
externalPort = 80
